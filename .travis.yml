dist: focal

language: python
matrix:
  include:
    - python: 3.6
    - python: 3.7
    - python: 3.8
    - python: 3.9
    - python: 3.10-dev

services:
  - docker

addons:
  sonarcloud:
    organization: maxbrunet-github
    token:
      secure: 2H8Xu2tDpeWtTGoxvMHaWfz8Uc16FSyPT+8kJHM0FSJhAgt1lI6vh8MlGDtQlNfG95HMQ1LhidNfu2re/QEiFpnDofaAQWQR0WdrnJjrsFTltwRDbfe0kgEitC9FC3E5Y/JPWDey5VHOxeJtdApXwloWKwbsN0Ww5zdF+Z25ZsS0bfmevxTaBZsyVNxTJzuX7g8dAlvFRlZU2oyzxODI092WJ+4eb9z0oEXQfyZsqmhQmRFDGDFVcRrLyG4Gut9nxHeaj7IspX3NTclN2ECssIQugfnERiYQN7qygRYzN3Bev69Fb98OJrRBxZYFLArAJOO6MW3PJDOVZwYkYW1kMiOrx7+Mz6CTFmeTw7T3t0IOulsQa/ud75oJFGYliAgqC53KrDICxmOrV1Q/bTqIffV5wOTJXq0JYHKvgkbLH7a9LIPXAvVL4aK/Ww5ba1vsYdw4nlX3PfUFopGtQwUBV66FeXkg30gWH/JzSfaJIVqJdlos6QsTpBKWWyL48vqYaVTdn0Z5lQ/DCohbMvMLHurtTNFcIEGzDMI4JvmfnwYSIVK8pJTlqAqNT9lFJswWLCL6uy2gIGS7TmUubipvA86LwCH9/8P2VALEF+0GP9prfZwZHXQJ0KgSsc7B2Ik3Khei5qEHeOVohQ3ZqJXPZ5BWJuMC7H0aHsCf+GRxdFg=

before_install:
  - tests/scripts/setup-mattermost.sh

install:
  - pip install -r poetry-requirements.txt
  - poetry install --verbose

script:
  - >-
    pytest
    --cov-report=xml:coverage-reports/coverage-${TRAVIS_PYTHON_VERSION}.xml
    --black
    --flake8
    --isort
  - sonar-scanner

deploy:
  provider: script
  script: poetry publish
  on:
    tags: true
    python: 3.9
